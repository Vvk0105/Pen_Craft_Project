{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>User Chat</title>
    <link rel="stylesheet" href="{% static 'css/index.css' %}" />
    <link rel="stylesheet" href="{% static 'css/chatwith.css' %}">
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</head>
<style>
    body {
        overflow: hidden;
    }
    .chat-display {
        overflow: auto;
        height: 78vh; 
        overflow-y: auto;
    }
    .chat-hold {
        height: 100%;
        /* overflow-y: auto; */
    }
</style>
<body>
    <nav id='common-home-navbar' class="navbar bg-body-tertiary">
        <div class="container-fluid appname">
            <img src="{% static 'images/Group 9.png' %}">
            <form class="d-flex usernav-links" role="search">
                {% if user.is_authenticated %}
                <p><a href="{% url 'home' %}">Home</a></p>
                {% else %}
                <p><a href="{% url '' %}">Home</a></p>
                {% endif %}
                <p><a href="">About Us</a></p>

                {% if user.is_staff %}
                <div class="dropdown">
                    <p class="">Submission</p>
                    <div class="dropdown-content">
                      <a href="{% url 'view_submissions' %}">Review submission</a>
                      <a href="{% url 'master_sub_hist' %}">Submission history</a>
                    </div>
                </div>
                {% else %}
                <div class="dropdown">
                    <p class="">Submission</p>
                    <div class="dropdown-content">
                      <a href="{% url 'submission_status' %}">Track submission</a>
                      <a href="{% url 'subm_his_user' %}">View submission history</a>
                    </div>
                </div>
                <p><a href="{% url 'view_masters' %}">Master Writers</a></p>
                <p><a href="{% url 'submit_writing' %}">Check Document</a></p>
                <p><a class="nav-link" href="{% url 'submit_complaint' %}">Add Complaint</a></p>
                {% endif %}
                
                {% if user.is_staff %}
                <p><a  class="nav-link" href="{% url 'master_chat' %}">Chat</a></p>
                {% else %}
                <p><a class="nav-link" href="{% url 'user_chat' %}">Chat</a></p>
                {% endif %}
                <!-- <p><a href="">Contact Us</a></p> -->
            </form>    
            {% if user.is_authenticated %}
                <div class="dropdown">
                    <a class="" type="button" id="" data-bs-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="37" viewBox="0 0 36 37" fill="none">
                            <path d="M6 27.9512C6 26.3599 6.63214 24.8337 7.75736 23.7085C8.88258 22.5833 10.4087 21.9512 12 21.9512H24C25.5913 21.9512 27.1174 22.5833 28.2426 23.7085C29.3679 24.8337 30 26.3599 30 27.9512C30 28.7468 29.6839 29.5099 29.1213 30.0725C28.5587 30.6351 27.7956 30.9512 27 30.9512H9C8.20435 30.9512 7.44129 30.6351 6.87868 30.0725C6.31607 29.5099 6 28.7468 6 27.9512Z" stroke="#2D2D2D" stroke-width="3" stroke-linejoin="round"/>
                            <path d="M18 15.9512C20.4853 15.9512 22.5 13.9365 22.5 11.4512C22.5 8.96589 20.4853 6.95117 18 6.95117C15.5147 6.95117 13.5 8.96589 13.5 11.4512C13.5 13.9365 15.5147 15.9512 18 15.9512Z" stroke="#2D2D2D" stroke-width="3"/>
                            </svg>
                        </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton" style="text-align: center;">
                        {% if user.userreg_set.exists %}
                            <!-- If User is a registered user -->
                            <!-- <li><a class="dropdown-item" href="{% url 'profile' %}" style="text-align: left;">Profile</a></li> -->
                        {% elif user.is_staff %}
                            <!-- If User is a master -->
                            <form action="{% url 'master_profile' %}" method="post" class="">
                                {% csrf_token %}
                            <li><button class="btn btn-link" href="" style="text-decoration: none; color: black; text-align: left;">Profile</button></li>
                            </form>
                        {% else %}
                            <!-- Handle cases where user type is unknown -->
                            <form action="{% url 'profile' %}" method="post" class="">
                                {% csrf_token %}
                            <li><button class="btn btn-link" href="" style="text-decoration: none; color: black; text-align: left;">Profile</button></li>
                            </form>
                        {% endif %}
                        <li>
                            <form action="{% url 'logout' %}" method="post" class="">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-link" style="text-decoration: none; color: black; text-align: left;">Logout</button>
                            </form>
                        </li>
                    </ul>
                </div>
            {% endif %}
        </div>
    </nav>

    <section class="container-fluid" id="dashboard" style="background-color: #EFF9FE;">
        <div class="row">
            <div class="col-md-3" style="margin-left: -12px;">
                <div class="sidebar">
                    {% for master in masters %}
                    <li class="flex-user-wrap">
                        <img class="img-fluid" src="{{ master.img.url }}" alt="">
                        <a href="?master_id={{ master.id }}">{{ master.username }}</a>
                    </li>
                    {% endfor %}
                </div>
            </div>
            <div class="chat-display col-9">
                <div class="chat-hold" style="background-color: #ffff;padding: 1px;">
                    <div style="background-color: white;border-radius: 40px; padding: 25px; margin-top: -1px;">
                        {% for message in messages %}
                        <div>
                            {% if message.sender_user %}
                                <strong class="sender">{{ message.message }}</strong>
                                <div class="clearfix"></div>
                            {% else %}
                                <strong >{{ message.message }}</strong>
                            {% endif %}
                            
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <form method="post" class="chat-box" action="{% url 'send_message' %}" >
                    {% csrf_token %}
                    <input type="hidden" name="receiver_master_id" value="{{ selected_master.id }}">
                    <input type="text" name="message" placeholder="Type a message" style="flex: 1; padding: 10px 15px; border-radius: 25px; outline: none; font-size: 14px;width: 140vh;">
                    <button type="submit" style="background: transparent; border: none; padding: 0;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="31" height="31" viewBox="0 0 31 31" fill="none">
                            <path d="M29.8363 15.0521L1.24498 0.717144C1.12877 0.659039 0.995465 0.645367 0.869 0.676129C0.578473 0.747906 0.39732 1.04185 0.469097 1.3358L3.41539 13.3739C3.45982 13.555 3.59312 13.702 3.77085 13.7601L8.81919 15.493L3.77427 17.2259C3.59654 17.2875 3.46324 17.431 3.42222 17.6122L0.469097 29.6673C0.438336 29.7938 0.452008 29.9271 0.510113 30.0399C0.643414 30.3099 0.971539 30.4193 1.24498 30.286L29.8363 16.0331C29.9422 15.9818 30.0277 15.8929 30.0824 15.7904C30.2157 15.5169 30.1063 15.1888 29.8363 15.0521ZM3.83921 26.2425L5.55845 19.2152L15.6483 15.7528C15.7269 15.7254 15.7918 15.6639 15.8192 15.5819C15.867 15.4383 15.7918 15.2845 15.6483 15.2333L5.55845 11.7743L3.84605 4.77427L25.3109 15.5375L3.83921 26.2425Z" fill="#2D2D2D"/>
                            </svg>
                    </button>
                </form>
            </div>
            </div>
        </div>
    </section>
            
        </div>
    </div>
</body>
</html>
